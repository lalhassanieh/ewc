<!doctype html>
{%- if settings.iso_rtl != blank and settings.enable_rtl -%}
  {%- assign is_rtl = fasle -%}
  {%- assign iso_code_arr_rtl = settings.iso_rtl | split: ';' -%}
  {%- for iso_arr_rtl in iso_code_arr_rtl -%}
    {%- assign iso_rtl = iso_arr_rtl | remove: ' ' -%}
    {%- if iso_rtl == shop.locale -%}
      {%- assign is_rtl = true -%}
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}
<html
  lang="{{ shop.locale }}"
  {% if is_rtl %}
    dir="rtl" class="rtl"
  {% endif %}
>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    {% if settings.favicon -%}
      <link rel="shortcut icon" href="{{ settings.favicon | image_url: width: 32, height: 32 }}" type="image/png">
    {%- endif %}
    <title>
      {{ page_title }}
      {% if current_tags -%}
        {%- assign meta_tags = current_tags | join: ', ' %} &ndash; {{ 'general.meta.tags' | t: tags: meta_tags -}}
      {%- endif %}
      {% if current_page != 1 %} &ndash; {{ 'general.meta.page' | t: page: current_page }}{% endif %}
      {% unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless %}
    </title>
    {% if page_description %}<meta name="description" content="{{ page_description | escape }}">{% endif %}
    {% include 'social-meta-tags' %}
    {% if settings['select-font-second'] == 'google' %}
      {{ settings['font-family-second-google-link'] }}
    {% endif %}
    {% if settings['select-font-base'] == 'google' %}
      {{ settings['font-family-base-google-link'] }}
    {% endif %}
    <link rel="canonical" href="{{ canonical_url }}">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no, user-scalable=no">
    <meta name="theme-color" content="{{ settings.color_primary }}">
    {% include 'header-styles' %}
    {% include 'header-javascript' %}
    {{ content_for_header }}
    {{ 'bi-custom.css' | asset_url | stylesheet_tag }}
  </head>
  {% if template contains 'collection' or template contains 'search' %}
    {%- assign layout_filter = settings.layout_filter -%}
  {%- endif -%}
  <body
    id="{{ page_title | handle }}"
    class="{{ layout_filter }} {% if customer %} customer-logged-in {% endif %}template-{{ request.page_type | handle }}{% if is_rtl %} rtl{% endif %}"
  >
    <div id="pre-loading" class="pre-loading loading-page">
      <div class="pre-loading__bar"></div>
    </div>
    {% section 'header-campar' %}
    {% section 'header-topbar' %}
    <header class="header">
      {%- liquid
        assign layout_header = settings.layout_header
        case layout_header
          when '1'
            section 'header_1'
        endcase
      -%}
    </header>
    <main class="main-content" role="main">
      {{ content_for_layout }}
    </main>

    <footer class="bwp-footer{% if settings.show_menu_bottom %} have-menu-bottom{% endif %}">
      {% sections 'footer-group' %}
    </footer>
    {% section 'custom-product-card' %}
    {% include 'svg' %}
    <div class="hidden" id="count_quantity">
      {%- for item in cart.items -%}
        <div data-variant_id="{{ item.variant_id }}" data-count_quantity="{{ item.variant.inventory_quantity }}"></div>
      {%- endfor -%}
    </div>
    {% include 'site-template' %}
    {%- if settings.show_compare -%}
      <div class="compare__table" grid-compare>
        <div class="show-compare">
          {{ 'compare.compare' | t -}}
          <span class="count">0</span>
        </div>
        <div class="content-compare">
          <div class="content product-card">
            <div class="hide-compare"></div>
            <div class="table">
              <ul class="remove-button">
                <li class="label"></li>
              </ul>
              <ul class="compare-name" data-label="{{'compare.name' | t }}"></ul>
              <ul class="compare-image"></ul>
              <ul class="compare-variants" data-label="{{'compare.variants' | t }}"></ul>
              <ul class="compare-availability" data-label="{{'compare.availability' | t }}"></ul>
              <ul class="compare-price" data-label="{{'compare.price' | t }}"></ul>
              <ul class="compare-atc"></ul>
            </div>
          </div>
        </div>
      </div>
    {%- endif -%}
    {% if template contains 'index' and settings.homepage_nofication %}
      {% include 'sale-nofication' %}
    {%- endif -%}
    {% if template contains 'collection' and settings.collectionpage_nofication %}
      {% include 'sale-nofication' %}
    {%- endif -%}
    {% if template contains 'product' and settings.productpage_nofication %}
      {% include 'sale-nofication' %}
    {%- endif -%}
    {% if template contains 'blog' and settings.blogpage_nofication %}
      {% include 'sale-nofication' %}
    {%- endif -%}
    {% if template contains 'article' and settings.articlepage_nofication %}
      {% include 'sale-nofication' %}
    {%- endif -%}
    {% if template contains 'cart' and settings.cartpage_nofication %}
      {% include 'sale-nofication' %}
    {%- endif -%}
    {% if template contains 'page' and settings.ortherpage_nofication %}
      {% include 'sale-nofication' %}
    {%- endif -%}
    {%- if settings.show_terms_conditions and settings.alert_terms_conditions != blank -%}
      <div class="content_terms_conditions">
        <div class="close-overlay" data-close-terms_conditions></div>
        <div class="content">
          <div class="close-conditions" data-close-terms_conditions></div>
          {%- if settings.label_alert_terms_conditions != blank -%}
            <div class="title">
              <h2>{{ settings.label_alert_terms_conditions }}</h2>
            </div>
          {%- endif -%}
          <div class="info">{{ settings.alert_terms_conditions }}</div>
        </div>
      </div>
    {%- endif -%}
    {% if template contains 'product' %}
      {% include 'view-gallery' %}
    {%- endif -%}
    <canvas id="fire_work" class="hide{% unless settings.cart_fire_work %} hidden{% endunless %}"></canvas>
    {%- if settings.enable_christmas -%}
      <div class="frame-snow"></div>
    {%- endif -%}
    {% include 'before-you-leave' %}
    <script>
      window.routes = {
      	predictive_search_url: '{{ routes.predictive_search_url }}',
      	user_purchased: '{{ settings.user_purchased }}',
      	list_time: '{{ settings.time_suggest }}',
      	product_recommendations_url: '{{ routes.product_recommendations_url }}',
      	product_pick_up: '{{ request.host }}',
      	round_currency: '{{ settings.round_currency }}',
      	hover_currency: '{{ settings.hover_currency }}',
      	currency_format: '{{ settings.currency_format }}',
      	auto_currency: '{{ settings.auto_currency }}',
      	shop_currency : '{{ cart.currency.iso_code }}',
      	shop_symbol : '{{ cart.currency.symbol }}',
      	svg_christmas : '{{ settings.svg_christmas | img_url:"" }}',
      	iso_code: '{{ request.locale.iso_code }}'
      };
      window.strings = {
      	wishlist: '{{ 'products.product.wishlist' | t }}',
      	view_more: '{{ 'collections.general.view_more' | t }}',
      	view_less: '{{ 'collections.general.view_less' | t }}',
      	remove_wishlist: '{{ 'products.product.remove_wishlist' | t }}',
      	compare: '{{ 'products.product.compare' | t }}',
      	remove_compare: '{{ 'products.product.remove_compare' | t }}',
      	CalculateMessSuccess: {{ settings.calculate_mess_success | default: 'We found one shipping rate available for' | json }},
      	CalculateMessPrice: {{ settings.calculate_mess_price | default: 'at' | json }},
      	CalculateMessError: {{ settings.calculate_mess_error | default: 'We do not ship to this destination.' | json }},
      	shippingCalcSubmitButton: {{ settings.shipping_calculator_submit_button_label | default: 'Calculate shipping' | json }},
      	shippingCalcSubmitButtonDisabled: {{ settings.shipping_calculator_submit_button_label_disabled | default: 'Calculating...' | json }},
      	{% if customer %}shippingCalcCustomerIsLoggedIn: true,{% endif %}
      	shippingCalcMoneyFormat: {{ shop.money_with_currency_format | json }}
      }
    </script>
    {% include 'footer-javascript' %}
    <script
      src="{{ '//cdn.shopify.com/s/files/1/0194/1736/6592/t/1/assets/booster-page-speed-optimizer.js?23' }}"
      defer="defer"
    ></script>

<script>
// Global Riyal Font Script for Product Prices
(function() {
    'use strict';
    
    let isInitialized = false;
    
    function detectCurrentCurrency() {
        // Method 1: Check BEAST Currency Converter attributes
        const priceElements = document.querySelectorAll('[doubly-currency]');
        if (priceElements.length > 0) {
            const currency = priceElements[0].getAttribute('doubly-currency');
            if (currency) {
                return currency;
            }
        }
        
        // Method 2: Text analysis fallback
        const allPrices = document.querySelectorAll('.js-product-price, .price-container, .ajaxcart__price');
        for (const priceEl of allPrices) {
            const text = priceEl.textContent || '';
            if (text.includes('SAR') || text.includes('ر.س')) {
                return 'SAR';
            }
        }
        
        return null;
    }
    
    function hideAllSARTextImmediately() {
        // Immediately hide SAR text on page load to prevent glitching
        const textElements = document.querySelectorAll('.js-product-price, .price-container, .ajaxcart__price');
        textElements.forEach(element => {
            if (element.innerHTML.includes('SAR')) {
                let text = element.innerHTML;
                text = text.replace(/SAR\s*/g, '');
                element.innerHTML = text;
                element.setAttribute('data-sar-processed', 'true');
            }
        });
    }
    
    function updateRiyalFontVisibility() {
        const currentCurrency = detectCurrentCurrency();
        
        // Update riyal font spans visibility using CSS classes
        const riyalFonts = document.querySelectorAll('.riyal-font');
        riyalFonts.forEach(span => {
            if (currentCurrency === 'SAR') {
                span.classList.add('show-riyal');
            } else {
                span.classList.remove('show-riyal');
            }
        });
        
        // Update SAR currency classes for padding
        const priceElements = document.querySelectorAll('.js-product-price, .js-product-compare-price, .price-container, .ajaxcart__price, .cart-total__subtotal-price, .cart-product-info__price, .cart-table__price, .cart__price, .order-discount, .product-price');
        priceElements.forEach(element => {
            if (currentCurrency === 'SAR') {
                element.classList.add('sar-currency');
            } else {
                element.classList.remove('sar-currency');
            }
        });
        
        // Handle SAR text removal - only on first initialization
        if (!isInitialized) {
            if (currentCurrency === 'SAR') {
                // SAR text already removed by hideAllSARTextImmediately
            } else {
                // If not SAR, restore processed flags for future use
                const textElements = document.querySelectorAll('[data-sar-processed]');
                textElements.forEach(element => {
                    element.removeAttribute('data-sar-processed');
                });
            }
            isInitialized = true;
        }
    }
    
    // Immediately hide SAR text on script load
    hideAllSARTextImmediately();
    
    // Wait for DOM to be fully ready, then initialize
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(updateRiyalFontVisibility, 50);
        });
    } else {
        // DOM is already ready
        setTimeout(updateRiyalFontVisibility, 50);
    }
    
    // Monitor for BEAST Currency Converter changes
    const observer = new MutationObserver(function(mutations) {
        let shouldUpdate = false;
        
        mutations.forEach(function(mutation) {
            // Only trigger on currency attribute changes
            if (mutation.type === 'attributes' && mutation.attributeName === 'doubly-currency') {
                shouldUpdate = true;
            }
            // Only trigger on significant DOM changes, not text modifications
            if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                for (let node of mutation.addedNodes) {
                    if (node.nodeType === 1 && ( // Element node
                        node.matches && (
                            node.matches('.js-product-price') || 
                            node.matches('.price-container') || 
                            node.matches('.ajaxcart__price') ||
                            node.querySelector('.js-product-price') ||
                            node.querySelector('.price-container') ||
                            node.querySelector('.ajaxcart__price')
                        )
                    )) {
                        shouldUpdate = true;
                        break;
                    }
                }
            }
        });
        
        if (shouldUpdate) {
            setTimeout(updateRiyalFontVisibility, 150);
        }
    });
    
    // Observe the entire document for changes
    observer.observe(document.body, {
        childList: true,
        subtree: true,
        attributes: true,
        attributeFilter: ['doubly-currency']
    });
    
    // Listen for BEAST Currency Converter events
    document.addEventListener('currencyChanged', function(e) {
        setTimeout(function() {
            const currentCurrency = detectCurrentCurrency();
            const riyalFonts = document.querySelectorAll('.riyal-font');
            const priceElements = document.querySelectorAll('.js-product-price, .js-product-compare-price, .price-container, .ajaxcart__price, .cart-total__subtotal-price, .cart-product-info__price, .cart-table__price, .cart__price, .order-discount, .product-price');
            
            riyalFonts.forEach(span => {
                if (currentCurrency === 'SAR') {
                    span.classList.add('show-riyal');
                } else {
                    span.classList.remove('show-riyal');
                }
            });
            
            priceElements.forEach(element => {
                if (currentCurrency === 'SAR') {
                    element.classList.add('sar-currency');
                } else {
                    element.classList.remove('sar-currency');
                }
            });
        }, 100);
    });
    
    // Minimal periodic check as backup
    setInterval(function() {
        if (isInitialized) {
            const currentCurrency = detectCurrentCurrency();
            const riyalFonts = document.querySelectorAll('.riyal-font');
            
            riyalFonts.forEach(span => {
                const shouldShow = currentCurrency === 'SAR';
                const isShowing = span.classList.contains('show-riyal');
                
                if (shouldShow && !isShowing) {
                    span.classList.add('show-riyal');
                } else if (!shouldShow && isShowing) {
                    span.classList.remove('show-riyal');
                }
            });
        }
    }, 15000);
})();
</script>
  </body>
</html>
